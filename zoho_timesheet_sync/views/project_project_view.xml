<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Vue formulaire projet enrichie avec Zoho -->
        <record id="view_project_project_form_zoho" model="ir.ui.view">
            <field name="name">project.project.form.zoho</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                
                <!-- Badge statut Zoho en haut -->
                <xpath expr="//div[@class='oe_title']" position="after">
                    <div class="alert alert-success" role="alert" 
                         invisible="x_sync_status != 'synced'">
                        <strong><i class="fa fa-check-circle"/> Synchronis√© avec Zoho</strong>
                        <span class="ml-2">Ce projet est connect√© aux services Zoho</span>
                    </div>
                    <div class="alert alert-warning" role="alert"
                         invisible="x_sync_status != 'pending'">
                        <strong><i class="fa fa-clock-o"/> Synchronisation en cours...</strong>
                    </div>
                    <div class="alert alert-danger" role="alert"
                         invisible="x_sync_status != 'error'">
                        <strong><i class="fa fa-exclamation-triangle"/> Erreur de synchronisation</strong>
                    </div>
                </xpath>
                
                <!-- Onglet Zoho am√©lior√© -->
                <xpath expr="//sheet/notebook" position="inside">
                    <page string="üîó Synchronisation Zoho" name="zoho_sync">
                        <group>
                            <group string="üìÅ WorkDrive">
                                <field name="x_zoho_folder_id" 
                                       placeholder="ID du dossier sera g√©n√©r√© automatiquement"/>
                                <button name="action_manual_sync" 
                                        type="object" 
                                        string="üîÑ Synchroniser vers WorkDrive"
                                        class="btn-primary"
                                        groups="zoho_timesheet_sync.group_zoho_admin"/>
                            </group>
                            <group string="üí¨ Cliq">
                                <field name="x_cliq_channel" 
                                       placeholder="Nom du canal sera g√©n√©r√© automatiquement"/>
                                <button name="action_manual_sync" 
                                        type="object" 
                                        string="üîÑ Synchroniser vers Cliq"
                                        class="btn-info"
                                        groups="zoho_timesheet_sync.group_zoho_admin"/>
                            </group>
                        </group>
                        
                        <group string="üìä Statut de synchronisation">
                            <field name="x_sync_status" widget="badge"/>
                        </group>
                        
                        <div class="mt-3" groups="zoho_timesheet_sync.group_zoho_admin">
                            <button name="action_manual_sync" 
                                    type="object" 
                                    string="üöÄ Synchronisation Compl√®te"
                                    class="btn btn-primary btn-lg"
                                    help="Lance une synchronisation compl√®te vers tous les services Zoho"/>
                        </div>
                        
                    </page>
                </xpath>
                
            </field>
        </record>
        
        <!-- Vue liste avec indicateurs visuels -->
        <record id="view_project_project_tree_zoho" model="ir.ui.view">
            <field name="name">project.project.tree.zoho</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.view_project_project_tree"/>
            <field name="arch" type="xml">
                
                <!-- Coloration selon statut sync -->
                <xpath expr="//tree" position="attributes">
                    <attribute name="decoration-success">x_sync_status == 'synced'</attribute>
                    <attribute name="decoration-warning">x_sync_status == 'pending'</attribute>
                    <attribute name="decoration-danger">x_sync_status == 'error'</attribute>
                </xpath>
                
                <!-- Colonnes Zoho -->
                <xpath expr="//field[@name='user_id']" position="after">
                    <field name="x_sync_status" string="üîó Zoho" widget="badge"/>
                </xpath>
                
            </field>
        </record>
        
        <!-- Action serveur pour synchronisation automatique (optionnelle) -->
        <record id="action_sync_project_server" model="ir.actions.server">
            <field name="name">Synchroniser avec Zoho</field>
            <field name="model_id" ref="project.model_project_project"/>
            <field name="binding_model_id" ref="project.model_project_project"/>
            <field name="binding_view_types">form,list</field>
            <field name="state">code</field>
            <field name="code">
                for record in records:
                    record.action_manual_sync()
            </field>
        </record>
        
    </data>
</odoo>